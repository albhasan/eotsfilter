# test_eotsfilter.R


#library(testthat)
#source("/home/alber/Documents/ghProjects/eotsfilter/R/eotsfilter.R")

# test error when NAs
asample <- '{"id":"123e4567-e89b-12d3-a456-426655440000","lat":-9.75012,"lon":-57.25692,"label":"sugar cane","timeline":["2000-02-18","2000-03-05","2000-03-21","2000-04-06","2000-04-22","2000-05-08","2000-05-24","2000-06-09","2000-06-25","2000-07-11","2000-07-27","2000-08-12","2000-08-28"],"validdata":[1,1,1,1,1,0,0,1,1,1,1,1,0],"attributes":[{"attribute":"ndvi","values":[4247,5420,7376,7890,8995,8968,8948,8928,8998,8935,8710,8846,8756]},{"attribute":"evi","values":[4549,3895,7290,5158,5273,4991,5326,5362,5198,5701,5174,5563,5356]}]}'
lambda <- 100
expect_error(whitaker1(lambda = 100, sample = asample))

# test correct use
asample <- '{"id":"123e4567-e89b-12d3-a456-426655440000","lat":-9.75012,"lon":-57.25692,"label":"sugar cane","timeline":["2000-02-18","2000-03-05","2000-03-21","2000-04-06","2000-04-22","2000-05-08","2000-05-24","2000-06-09","2000-06-25","2000-07-11","2000-07-27","2000-08-12","2000-08-28"],"validdata":[1,1,1,1,1,1,1,1,1,1,1,1,1],"attributes":[{"attribute":"ndvi","values":[4247,5420,7376,7890,8995,8968,8948,8928,8998,8935,8710,8846,8756]},{"attribute":"evi","values":[4549,3895,7290,5158,5273,4991,5326,5362,5198,5701,5174,5563,5356]}]}'
ares <- '{"id":["123e4567-e89b-12d3-a456-426655440000"],"lat":[-9.7501],"lon":[-57.2569],"label":["sugar cane"],"timeline":["2000-02-18","2000-03-05","2000-03-21","2000-04-06","2000-04-22","2000-05-08","2000-05-24","2000-06-09","2000-06-25","2000-07-11","2000-07-27","2000-08-12","2000-08-28"],"validdata":[1,1,1,1,1,1,1,1,1,1,1,1,1],"attributes":[{"attribute":"ndvi-whitaker1","values":[7797.6691,7833.1758,7892.8142,7957.6208,8023.1036,8078.8674,8125.7399,8164.3898,8195.4037,8218.3915,8234.2133,8245.2771,8250.3338]},{"attribute":"evi-whitaker1","values":[5258.3536,5265.4471,5286.2451,5287.0056,5289.0561,5291.2671,5296.4809,5301.3994,5305.712,5311.1017,5312.5923,5315.4689,5315.8702]}]}'
lambda <- 100
expect_equal(whitaker1(lambda = 100, sample = asample), ares)

